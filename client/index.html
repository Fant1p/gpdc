<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Tuto WebSocket avec Socket.io et NodeJS par PracticalProgramming.fr</title>
    </head>

    <body>

        <div id="formPlayer">
            <form action="#">
                <label for="nickname"> CHOOSE A NAME </label>
                <input id="nickInput" name="nickname" type="text" required>
            </form>
             <button onclick="enterGame(document.getElementById('nickInput').value)">TO WORK -> </button>
        </div>
        <div id="gameInterface" hidden>
            <canvas id="ctx" width="500" height="500" style="border:1px solid #000 "></canvas>
        </div>


        <!-- CREATION SOCKET -->
        <script src="https://cdn.socket.io/3.1.1/socket.io.min.js" integrity="sha384-gDaozqUvc4HTgo8iZjwth73C6dDDeOJsAgpxBcMpZYztUfjHXpzrpdrHRdVp8ySO" crossorigin="anonymous"></script>
        <!-- <script src="/socket.io/socket.io.js"></script> -->
        <script>

            let ctx = document.getElementById('ctx').getContext("2d");
            ctx.font='30px Arial';

            const socket = io();
            let enterGame = function(nickname){
                // EMIT
                socket.emit('isConnected',{
                    username : nickname,
                });

                // ON
                socket.on('tabJoueurs',(data)=>{
                    userArr = data.tabJoueurs;
                    console.log(userArr);
                });

                socket.on('newPositions', function(data){
                    // console.log(data);
                    ctx.clearRect(0,0,500,500);
                    for(var i = 0; i < data.length;i++){
                       ctx.fillText(userArr[i], data[i].x, data[i].y);
                    }
                    
                });

                // INTERFACE

                hideWindow('formPlayer');
                displayWindow('gameInterface');

                // INTERACTIONS CLAVIER

                document.onkeydown = function(event){
                    if(event.keyCode === 68 ){  //D
                        socket.emit('keyPress',{inputId:'right', state:true});
                    } 
                    else if(event.keyCode === 83){  //S
                        socket.emit('keyPress',{inputId:'down', state:true});
                    } 
                    else if(event.keyCode === 81){  //Q
                        socket.emit('keyPress',{inputId:'left', state:true});
                    }
                    else if(event.keyCode === 90){  //Z
                        socket.emit('keyPress',{inputId:'up', state:true});
                    }

                }

                document.onkeyup = function(event){
                    // console.log(event.keyCode);
                    if(event.keyCode === 68 ){  //D
                        socket.emit('keyPress',{inputId:'right', state:false});
                    } 
                    else if(event.keyCode === 83){  //S
                        socket.emit('keyPress',{inputId:'down', state:false});
                    } 
                    else if(event.keyCode === 81){  //Q
                        socket.emit('keyPress',{inputId:'left', state:false});
                    }
                    else if(event.keyCode === 90){  //Z
                        socket.emit('keyPress',{inputId:'up', state:false});
                    }

                }
            }
            


            function displayWindow(id){
                document.getElementById(id).style.display = 'block';
            }

            function hideWindow(id){
                document.getElementById(id).style.display = 'none';
            }

            // message('Bienvenue');
            
        </script>

    <!-- FIN CODE SOCKET -->
    </body>
</html>